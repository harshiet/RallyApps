<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>User Stories By Iteration Example</title>
<script type="text/javascript"
	src="https://rally1.rallydev.com/apps/1.32/sdk.js"></script>
<script type="text/javascript">
	var rallyDataSource = null;
	var iterDropdown = null;
	vartable = null;

	function showUserStoriesTable(results) {
		if (table) {
			table.destroy();
		}

		var rankIx = 1;
		for ( var i = 0; i < results.stories.length; i++, rankIx++) {
			results.stories[i].Ranking = rankIx; // to get 1 through N rankings...
		}

		var tableConfig = {
			columnKeys : [ 'Ranking', 'FormattedID', 'Name' ],
			columnHeaders : [ 'Ranking', 'FormattedID', 'Name' ],
			columnWidths : [ '60px', '80px', '360px' ]
		};
		table = new rally.sdk.ui.Table(tableConfig);
		table.addRows(results.stories);
		table.display(document.getElementById('stories'));
	}

	function onIterationSelected() {
		document.getElementById('stories').innerHTML = "";
		var queryConfig = {
			key : 'stories',
			type : 'hierarchicalrequirement',
			fetch : 'Rank,FormattedID,Name',
			query : '(Iteration.Name = "' + iterDropdown.getSelectedName()
					+ '")',
			order : 'Rank'
		};
		rallyDataSource.findAll(queryConfig, showUserStoriesTable);
	}

	function onLoad() {
		rallyDataSource = new rally.sdk.data.RallyDataSource(
				"872858354", "9177325413",
				"__PROJECT_SCOPING_UP__", "__PROJECT_SCOPING_DOWN__")
		var iterConfig = {
			label : ""
		};
		iterDropdown = new rally.sdk.ui.IterationDropdown(iterConfig,
				rallyDataSource);
		iterDropdown.display(document.getElementById("iterationDiv"),
				onIterationSelected);
	}

	rally.addOnLoad(onLoad);
</script>

</head>
<body>
	<div>
		<div style="margin-left: 20px; margin-bottom: 5px; font-weight: bold;">Select
			Iteration</div>
		<div id="iterationDiv"></div>
	</div>
	<br />
	<br />
	<div id="stories"></div>
</body>
</html>